- @finish_states={'COMPLETED'=>'far fa-grin-beam','NODE_FAIL'=>'far fa-grimace','FAILED'=>'far fa-frown','CANCELLED'=>'far fa-meh-rolling-eyes','TIMEOUT'=>'far fa-flushed'}

// pass ruby variables to js
- group_plus = @rules_plus['groups']
- def_icon = {'icon'=>'far fa-exclamation-triangle', 'color'=>'color-regular'}

h3 –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á–∞—Ö

- @notes=Core::Notice.where(sourceable: @current_user)
- @notes.each do |n|
  div 
    | #{n.message} (#{n.linkable ? n.linkable.state : '---'})

button onclick="startIntro()" intro

p id="intro-step1" data-step="1" –ù–∞ –¥–∞–Ω–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –≤—ã –º–æ–∂–µ—Ç–µ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∞—à–∏—Ö –∑–∞–¥–∞—á–∞—Ö, –∞ —Ç–∞–∫–∂–µ –æ—Ü–µ–Ω–∏—Ç—å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è. –î–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–ª—å–∫–æ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏—Ö –∑–∞–¥–∞—á —É–∫–∞–∂–∏—Ç–µ –Ω–∏–∂–µ —Ç—Ä–µ–±—É–µ–º—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã.

= render "form"

div class='thanks' id='thanks_box'
  div &nbsp;
  div class="thanks-text"
    | –°–ø–∞—Å–∏–±–æ!
  div &nbsp;

- if @notice
  p style = 'color:#FF0000;' = @notice

  /button onClick="$('#agree_all_confirmation').addClass('target')" id='agree_all'
    | –Ø —Å–æ–≥–ª–∞—Å–µ–Ω —Å –æ—Ü–µ–Ω–∫–∞–º–∏ –º–æ–∏—Ö –∑–∞–ø—É—Å–∫–æ–≤
  /div class="octo-popup" id="agree_all_confirmation"
    /div class="content"
    form onSubmit="$('#agree_all_confirmation').removeClass('target');agree_all(); return false"
      div class="centered"
        | –í—Å–µ –∑–∞–º–µ—á–∞–Ω–∏—è –±–µ–∑ –æ—Ü–µ–Ω–æ–∫ –ø–æ –í–∞—à–∏–º –∑–∞–ø—É—Å–∫–∞–º –±—É–¥—É—Ç –æ—Ç–º–µ—á–µ–Ω—ã –∫–∞–∫ 
        strong "—Å–æ–≥–ª–∞—Å–µ–Ω —Å –æ—Ü–µ–Ω–∫–æ–π"
      div class="centered"
        button class="btn-info" type="submit"
          | –î–∞, —è —Å–æ–≥–ª–∞—Å–µ–Ω —Å–æ –≤—Å–µ–º–∏ –æ—Ü–µ–Ω–∫–∞–º–∏!
        button onClick="$('#agree_all_confirmation').removeClass('target'); return false"
          | –ü–µ—Ä–µ–¥—É–º–∞–ª
  /a class="octo-close-popup" onClick="$('#agree_all_confirmation').removeClass('target'); return false"

  /| –ù–µ —Å–æ–≥–ª–∞—Å–Ω—ã —Å –æ—Ü–µ–Ω–∫–æ–π –∑–∞–ø—É—Å–∫–æ–≤?
  /div id='disagree_reason_box' style="display: none; width: 100%" class="feedback_div"
    br
    | –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–¥–∞—á–∏ –≤ —Å–ø–∏—Å–∫–µ –Ω–∏–∂–µ (–ª–µ–≤—ã–π —Å—Ç–æ–ª–±–µ—Ü), –∏ –ø—Ä–∞–≤–∏–ª–∞, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ä–∞–±–æ—Ç–∞–ª–∏ –Ω–µ–≤–µ—Ä–Ω–æ (–≤ —Å–ø–∏—Å–∫–µ –Ω–∏–∂–µ):
    div style="width: 100%" id="disagree_rules" class="feedback_list"
      | - –ü–æ–∫–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω—ã –∑–∞–¥–∞—á–∏, –ø–æ—ç—Ç–æ–º—É –≤ —Å–ø–∏—Å–∫–µ –Ω–µ—Ç –ø—Ä–∞–≤–∏–ª...
    br
    | –ü–æ—è—Å–Ω–∏—Ç–µ, –ø–æ—á–µ–º—É –í—ã –Ω–µ —Å–æ–≥–ª–∞—Å–Ω—ã —Å —ç—Ç–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏?
    input type='text' id='disagree_reason' style="right: 0px; width: 99%"
    br
  /button id="disagree_button" onClick="multi_job_feedback()" alt="–ù–µ —Å–æ–≥–ª–∞—Å–µ–Ω!"
    | –ñ–º–∏—Ç–µ —Ç—É—Ç!
div
  br
  p id="intro-step3"  data-step="3"
    | –í —Å—Ç–æ–ª–±—Ü–µ "–ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã" —É–∫–∞–∑–∞–Ω—ã –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã —Å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é, –æ–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–ª—è –¥–∞–Ω–Ω–æ–π –∑–∞–¥–∞—á–∏. –ß—Ç–æ–±—ã –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∏—Ö –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ, —Å–∫—Ä—ã—Ç—å –∏—Ö –≤–∏–¥–∏–º–æ—Å—Ç—å –∏–ª–∏ –ø—Ä–æ–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –ø—Ä–∏–º–µ–Ω–∏–º–æ—Å—Ç—å –∫ –∑–∞–¥–∞—á–µ, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞–∂–∞—Ç—å –Ω–∞ –∑–Ω–∞—á–æ–∫ 
    i class="fas fa-bars"
    | . –ó–Ω–∞—á–æ–∫ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç–∏–ø—É –Ω–∞–π–¥–µ–Ω–Ω–æ–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –ø—Ä–æ–±–ª–µ–º—ã (–Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç—ã —Å MPI, –Ω–∏–∑–∫–∞—è –ª–æ–∫–∞–ª—å–Ω–æ—Å—Ç—å –æ–±—Ä–∞—â–µ–Ω–∏–π –≤ –ø–∞–º—è—Ç—å –∏ —Ç.–¥.). –¶–≤–µ—Ç –æ–±–æ–∑–Ω–∞—á–∞–µ—Ç –µ–µ –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å (–∫—Ä–∞—Å–Ω—ã–π ‚Äì —Ä–∞–¥–∏–∫–∞–ª—å–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∏–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, —á–µ—Ä–Ω—ã–π ‚Äì –∑–∞–º–µ—Ç–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, –∑–µ–ª–µ–Ω—ã–π ‚Äì –ø—Ä–æ–±–ª–µ–º –Ω–µ –Ω–∞–π–¥–µ–Ω–æ).
  p –ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º —Å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é, –∞ —Ç–∞–∫–∂–µ –¥—Ä—É–≥–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–π –∑–∞–¥–∞—á–µ, –ø—Ä–∏–≤–µ–¥–µ–Ω—ã –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ. –ß—Ç–æ–±—ã –ø–æ–ø–∞—Å—Ç—å –Ω–∞ —ç—Ç—É —Å—Ç—Ä–∞–Ω–∏—Ü—É, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞–∂–∞—Ç—å –Ω–∞ ID —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –∑–∞–¥–∞—á–∏.
  p 
    | –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º —Å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∏—Ö –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ, –∞ —Ç–∞–∫–∂–µ –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å —Å–≤–æ–µ –Ω–æ–≤–æ–µ –ø—Ä–∞–≤–∏–ª–æ –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é –º–æ–∂–Ω–æ –Ω–∞ 
    a href='all_rules' —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    |.
  p 
    | –ï—Å—Ç—å –æ–±—â–∏–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è –∏–ª–∏ –∑–∞–º–µ—á–∞–Ω–∏—è? –û—Ç–ø—Ä–∞–≤—å—Ç–µ 
    a href='mailto://feedback-octoshell@parallel.ru' e-mail
    | . –ê –ª—É—á—à–µ - –Ω–∞–ø–∏—à–∏—Ç–µ 
    a href="/support/tickets/new" –∑–¥–µ—Å—å.
div
  button onClick="$('#mass_notok').addClass('target'); multi_job_feedback_start()"
    | –Ø –Ω–µ —Å–æ–≥–ª–∞—Å–µ–Ω —Å –Ω–µ–∫–æ—Ç–æ—Ä—ã–º–∏ –æ—Ü–µ–Ω–∫–∞–º–∏...
  div id="mass_notok" class='roll-down col-12 gray-round-background'
    p –í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–µ –∑–∞–ø—É—Å–∫–∏ –≥–∞–ª–æ—á–∫–∞–º–∏ –≤ –ª–µ–≤–æ–º —Å—Ç–æ–ª–±—Ü–µ.
      –í –æ–±–ª–∞—Å—Ç–∏ –Ω–∏–∂–µ –±—É–¥—É—Ç –ø–æ–∫–∞–∑–∞–Ω—ã –ø—Ä–∞–≤–∏–ª–∞, –æ–±—â–∏–µ –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤.
      –í—ã–±–µ—Ä–∏—Ç–µ –≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞, —Å –∫–æ—Ç–æ—Ä—ã–º–∏ –í—ã –Ω–µ —Å–æ–≥–ª–∞—Å–Ω—ã –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –Ω–∞–º –æ—Ç–∑—ã–≤.

    div id="disagree_rules" class="feedback_list col-12"
      | - –ü–æ–∫–∞ –Ω–µ –≤—ã–±—Ä–∞–Ω—ã –∑–∞–¥–∞—á–∏, –ø–æ—ç—Ç–æ–º—É –≤ —Å–ø–∏—Å–∫–µ –Ω–µ—Ç –ø—Ä–∞–≤–∏–ª...

    button onclick="$('#mass_notok_confirm').addClass('target')"
      | –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–∑—ã–≤
    button onclick="$('#mass_notok').removeClass('target'); restore_disagree();"
      | –ü–µ—Ä–µ–¥—É–º–∞–ª –æ—Å—Ç–∞–≤–ª—è—Ç—å –æ—Ç–∑—ã–≤

    div id="mass_notok_confirm" class="octo-popup"
      | –ü–æ—è—Å–Ω–∏—Ç–µ, –ø–æ—á–µ–º—É –í—ã –Ω–µ —Å–æ–≥–ª–∞—Å–Ω—ã —Å —ç—Ç–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏?
      input type='text' id='disagree_reason' style="right: 0px; width: 99%"
      div class="centered"
        button class="btn-info" onClick="multi_job_feedback(); $('#mass_notok').removeClass('target'); $('#mass_agree').removeClass('target'); $('#mass_notok_confirm').removeClass('target')"
          | –û—Ç–ø—Ä–∞–≤–∏—Ç—å!
        button class="btn-info" onClick="$('#mass_notok_confirm').removeClass('target');"
          | –ü–µ—Ä–µ–¥—É–º–∞–ª
    a class="octo-close-popup" onClick="$('#mass_notok_confirm').removeClass('target'); return false"


div class="perf-table"
  /p
    | Sort by &nbsp;
    a class="btn btn-info sorting" data-column="8" data-direction="0" data-item="0" num nodes
    | &nbsp;
    a class="btn btn-info sorting" data-column="8" data-direction="0" data-item="1" duration
    | &nbsp;
    a class="btn btn-info sorting" data-column="8" data-direction="0" data-item="2" core*hours
  input type="checkbox" class="hide-login-data" id="hide-login-checkbox" checked=1
  label for="hide-login-checkbox" –°–∫—Ä—ã—Ç—å –ª–æ–≥–∏–Ω/—Ä–∞–∑–¥–µ–ª
  br
  input type="checkbox" class="hide-perf-data" id="hide-perf-checkbox"
  label for="hide-perf-checkbox" –°–∫—Ä—ã—Ç—å –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

  h3
    - if @total_count==0
      | –ù–µ—Ç –∑–∞–¥–∞—á —Å —Ç–∞–∫–∏–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏...
    - else
      | –ü–æ–∫–∞–∑–∞–Ω—ã –∑–∞–¥–∞—á–∏: #{@params[:offset]}..#{@params[:offset].to_i + @shown} –∏–∑ #{@total_count}
  p id="hidden_count"
  table
    tr
      td
        - if @params[:offset].to_i >= @PER_PAGE
          a href="#{url_for @params.except(:offset).merge(offset: @params[:offset].to_i - @PER_PAGE)}" <<<
      td width="10px"
      td
        - if @jobs.length == 100
          a href="#{url_for @params.except(:offset).merge(offset: @params[:offset].to_i + @PER_PAGE)}" >>>
  table id="jobs" class="table table-bordered tablesorter-default"
    thead
      tr
        th data-sorter="false"
          p
            |
        th data-sorter="false"
          p title="—Å–ø–∏—Å–æ–∫ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö(sic!) –ø—Ä–æ–±–ª–µ–º, –≤–æ–∑–Ω–∏–∫—à–∏—Ö –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
            | –ù–∞–π–¥–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
        th
          p title="–Ω–æ–º–µ—Ä –∑–∞–¥–∞—á–∏ –≤ –º–µ–Ω–µ–¥–∂–µ—Ä–µ —Ä–µ—Å—É—Ä—Å–æ–≤ (slurm)"
            | ID –∑–∞–¥–∞—á–∏
        th class="login-data"
          p title="–ª–æ–≥–∏–Ω, –ø–æ–¥ –∫–æ—Ç–æ—Ä—ã–º –±—ã–ª–æ –∑–∞–ø—É—â–µ–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
            | –õ–æ–≥–∏–Ω
        th class="login-data"
          p title="—Ä–∞–∑–¥–µ–ª —Å—É–ø–µ—Ä–∫–æ–º–ø—å—é—Ç–µ—Ä–∞, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º –±—ã–ª–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ"
            | –†–∞–∑–¥–µ–ª
        th
          p title="–≤—Ä–µ–º—è –Ω–∞—á–∞–ª–∞ —Å—á—ë—Ç–∞"
            | –ù–∞—á–∞–ª–æ —Å—á–µ—Ç–∞
        th
          p title="–≤—Ä–µ–º—è –æ–∫–æ–Ω—á–∞–Ω–∏—è —Å—á—ë—Ç–∞"
            | –ö–æ–Ω–µ—Ü —Å—á–µ—Ç–∞
        th class="icon-x2-width"
          p title="—Å—Ç–∞—Ç—É—Å –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞—Å—á—ë—Ç–∞"
            | –°—Ç–∞—Ç—É—Å
        th
          p title="–≤ —à—Ç—É–∫–∞—Ö"
            | –ß–∏—Å–ª–æ —É–∑–ª–æ–≤
        th
          p title="–≤—Ä–µ–º—è –≤ —á–∞—Å–∞—Ö"
            | –í—Ä–µ–º—è —Å—á–µ—Ç–∞ (—á–∞—Å—ã)
        th
          p title="–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ —á–∏—Å–ª–∞ –∑–∞–Ω—è—Ç—ã—Ö —è–¥–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ –Ω–∞ –≤—Ä–µ–º—è —Ä–∞—Å—á—ë—Ç–∞<br>–≤—Å–µ —è–¥—Ä–∞ –æ–¥–Ω–æ–≥–æ —É–∑–ª–∞ —Å—á–∏—Ç–∞—é—Ç—Å—è –∑–∞–Ω—è—Ç—ã–º–∏ –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–∞ –Ω–∏—Ö –Ω–µ –±—ã–ª–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —Å—á—ë—Ç–∞"
            | –†–∞–∑–º–µ—Ä –∑–∞–¥–∞—á–∏ (—è–¥—Ä–æ-—á–∞—Å—ã)
        th class="perf-data"
          p title="–≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö –æ—Ç –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏"
            | –ó–∞–≥—Ä—É–∑–∫–∞ –¶–ü–£
        th class="perf-data"
          p title="–≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö –æ—Ç –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏"
            | –ó–∞–≥—Ä—É–∑–∫–∞ –ì–ü–£
        th class="perf-data"
          p title="—Å—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤"
            | Load average
        th class="perf-data"
          p title="—Å—Ä–µ–¥–Ω–µ–µ —á–∏—Å–ª–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π, –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –∑–∞ —Ç–∞–∫—Ç"
            | IPC
        th class="perf-data"
          p title="–≤ –º–µ–≥–∞–±–∞–π—Ç–∞—Ö/—Å–µ–∫"
            | –ü–æ–ª—É—á–µ–Ω–æ –±–∞–π—Ç –ø–æ MPI (–ú–ë/—Å)
        th class="perf-data"
          p title="–≤ –º–µ–≥–∞–±–∞–π—Ç–∞—Ö/—Å–µ–∫"
            | –ü–µ—Ä–µ–¥–∞–Ω–æ –±–∞–π—Ç –ø–æ MPI (–ú–ë/—Å)
    - index=0
    - @jobs.each do |job|
      - index+=1
      - job_performance = job.get_performance
      - job_ranking = job.get_ranking
      - #job_cond = job.get_rules @current_user #@jobs_plus[job.drms_job_id]['rules']
      - job_cond = @jobs_plus[job.drms_job_id]['rules'].keys
      - perf_data_present=!job_performance[:cpu_user].nil?
      - row_id = @fake_data==0 ? job.drms_job_id : 'fake'
      tr id="job_row_#{row_id}" data-jobid="#{job.drms_job_id}" data-info-state="#{perf_data_present ? 0 : -1}" data-step="4"
        td id=("fake_menu" if @fake_data!=0)
          input type="checkbox" class="job_check" style="display: none;" data-job-id="#{job.drms_job_id}" onChange="job_check_clicked(#{job.drms_job_id})"
          a class="red-on-hover" onClick="$('#job_info_#{index}').addClass('target')" title="–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ –ø—Ä–∞–≤–∏–ª–∞—Ö, —Å–∫—Ä—ã—Ç—å/–ø—Ä–æ–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∞–≤–∏–ª–∞" data-disable-interaction=1
            i class="fas fa-bars"
          // feedback dropdown window
          div id="job_info_#{index}" class="octo-popup"
            a class="octo-popup-close" onClick="$('#job_info_#{index}').removeClass('target')"&times;
            - if perf_data_present
              - if job_cond.size > 0
                - job_cond.each do |cond|
                  div class="cond-div #{@filters.include?(cond) ? 'hidden' : 'visible'}" data-rule-div="#{cond}"
                    // current feedback icon
                    - feedback=@jobs_plus[job.drms_job_id]['feedback']
                    i id="af-#{job.drms_job_id}-#{cond}" class="#{@agree_flags[feedback.fetch(cond,99)]}"
                    /'fa-ok agreed-flag'
                    | &nbsp;
                    
                    // "hide rule" button
                    button class="btn-danger" onClick="popup_show('hide#{job.drms_job_id}_#{cond}','question_hide#{job.drms_job_id}_#{cond}');" title="–°–∫—Ä—ã—Ç—å –ø—Ä–∞–≤–∏–ª–æ" id=('fake_hide' if @fake_data!=0) data-disable-interaction=1 data-step="5"
                      i class="far fa-bell-slash"
                    | &nbsp; 

                    // "I disagree with rule" button
                    button class="btn-warning disagree-button" onClick="popup_show('disagree#{job.drms_job_id}_#{cond}','question_#{job.drms_job_id}_#{cond}');" title="–ù–µ —Å–æ–≥–ª–∞—Å–µ–Ω!" id=('fake_not_ok' if @fake_data!=0) data-disable-interaction=1 data-step="6"
                      i class="#{@agree_flags[1]}"
                      /"far fa-angry"
                    | &nbsp; 
                    
                    button class="btn-warning" onClick="popup_show('agree#{job.drms_job_id}_#{cond}','question_#{job.drms_job_id}_#{cond}');" title="–°–æ–≥–ª–∞—Å–µ–Ω —Å –æ—Ü–µ–Ω–∫–æ–π." id=('fake_hide' if @fake_ok!=0) data-disable-interaction=1 data-step="7"
                      i class="#{@agree_flags[0]}"
                    | &nbsp; 
                    
                    // rule icon
                    - rule = @rules_plus['rules'].fetch(cond, nil)
                    - icon = rule ? group_plus.fetch(rule['group'],def_icon) : def_icon
                    a href="all_rules#go-#{cond}"
                      i class="em15 fa-fw align-left inline #{icon['icon']} #{icon['color']}" title="–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–∏—Å–∞–Ω–∏—é –ø—Ä–∞–≤–∏–ª–∞"
                    | &nbsp; 

                    = @rules_plus['rules'].fetch(cond,{}).fetch('description','–û–π, —É –Ω–∞—Å —Ç—É—Ç –æ—à–∏–±–∫–∞ —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º –ø—Ä–∞–≤–∏–ª–∞, —Å–æ–æ–±—â–∏—Ç–µ –Ω–∞–º –æ–± —ç—Ç–æ–º, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞.')

                    // agree/disagree one rule dialog
                    /div class="octo-popup2 container" id="vote-#{job.drms_job_id}-#{cond}"
                      a class="btn" onClick="agree('#{job.drms_job_id}','#{cond}');$('#vote-#{job.drms_job_id}-#{cond}').removeClass('target')"
                        i class="far fa-thumbs-up agreed-flag"
                        | –°–æ–≥–ª–∞—Å–µ–Ω —Å –ø—Ä–∞–≤–∏–ª–æ–º!
                      br
                      a class="btn" onClick="disagree('#{job.drms_job_id}','#{cond}');$('#vote-#{job.drms_job_id}-#{cond}').removeClass('target')"
                        i class="far fa-thumbs-down agreed-flag"
                        | –ù–µ —Å–æ–≥–ª–∞—Å–µ–Ω —Å –ø—Ä–∞–≤–∏–ª–æ–º!
                      br
                    /a class="octo-close-popup2" onClick="$('#vote-#{job.drms_job_id}-#{cond}').removeClass('target')"

                    // "why hide?" dialog
                    div class="octo-popup2 container" id="popup_hide#{job.drms_job_id}_#{cond}"
                        /div class="content container"
                        form onSubmit="popup_hide('hide#{job.drms_job_id}_#{cond}');hide_rule(#{job.drms_job_id},'#{cond}'); return false;"
                          div class="centered"
                            | –≠—Ç–æ –ø—Ä–∞–≤–∏–ª–æ –±—É–¥–µ—Ç —Å–∫—Ä—ã—Ç–æ –≤–æ –≤—Å–µ—Ö –∑–∞–¥–∞–Ω–∏—è—Ö, –≤ —Ç–æ–º —á–∏—Å–ª–µ –±—É–¥—É—â–∏—Ö. –ü–æ—è—Å–Ω–∏—Ç–µ, –ø–æ—á–µ–º—É –í—ã —Ö–æ—Ç–∏—Ç–µ —Å–∫—Ä—ã—Ç—å –µ–≥–æ?
                          input type="text" id="question_hide#{job.drms_job_id}_#{cond}" class="fullwidth"
                          div class="centered col-12"
                            button class="btn-info" type="submit"
                              | –û—Ç–ø—Ä–∞–≤–∏—Ç—å!
                            button class="btn-info" onClick="return popup_hide('hide#{job.drms_job_id}_#{cond}');"
                              | –ü–µ—Ä–µ–¥—É–º–∞–ª
                    a class="octo-close-popup2" onClick="return popup_hide('hide#{job.drms_job_id}_#{cond}');"


                    // "Disagree" dialog
                    div class="octo-popup2 container" id="popup_disagree#{job.drms_job_id}_#{cond}"
                      form onSubmit="popup_hide('disagree#{job.drms_job_id}_#{cond}');disagree('#{job.drms_job_id}','#{cond}',0); return false;"
                        div class="centered"
                          | –ü–æ—è—Å–Ω–∏—Ç–µ, –ø–æ—á–µ–º—É –í—ã –Ω–µ —Å–æ–≥–ª–∞—Å–Ω—ã —Å –æ—Ü–µ–Ω–∫–æ–π –ø—Ä–∞–≤–∏–ª–∞?
                        input type="text" id="question_#{job.drms_job_id}_#{cond}" class="fullwidth"
                        div class="centered"
                          button class="btn-info" type="submit"
                            | –û—Ç–ø—Ä–∞–≤–∏—Ç—å!
                          button class="btn-info" onClick="return popup_hide('disagree#{job.drms_job_id}_#{cond}')"
                            | –ü–µ—Ä–µ–¥—É–º–∞–ª
                    a class="octo-close-popup2" onClick="return popup_hide('disagree#{job.drms_job_id}_#{cond}')"

                    // 'Agree' dialog
                    div class="octo-popup2 container" id="popup_agree#{job.drms_job_id}_#{cond}"
                      form onSubmit="popup_hide('agree#{job.drms_job_id}_#{cond}'); agree('#{job.drms_job_id}','#{cond}',0,''); return false;"
                        div class="centered"
                          button class="btn-info" type="submit"
                            | –î–∞, —è —Å–æ–≥–ª–∞—Å–µ–Ω —Å —ç—Ç–∏–º –ø—Ä–∞–≤–∏–ª–æ–º –¥–ª—è —ç—Ç–æ–π –∑–∞–¥–∞—á–∏.
                          button class="btn-info" onClick="return popup_hide('agree#{job.drms_job_id}_#{cond}')"
                            | –ü–µ—Ä–µ–¥—É–º–∞–ª
                    a class="octo-close-popup2" onClick="return popup_hide('agree#{job.drms_job_id}_#{cond}')"
              - else
                i class="em2 fas fa-fw fa-check color-green"
                | –í—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ, –∑–∞–º–µ—á–∞–Ω–∏–π –Ω–µ—Ç!
            - else
              p 
                | –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∑–∞–¥–∞—á–µ :(
          a class="octo-close-popup" onClick="$('#job_info_#{index}').removeClass('target')"
        td id=('fake_cond' if @fake_data!=0) data-disable-interaction=0
          - if perf_data_present
            - if job_cond.size > 0
              - hidden_count=0
              - job_cond.each do |cond|
                - rule = @rules_plus['rules'].fetch(cond, nil)
                - icon = rule ? group_plus.fetch(rule['group'],def_icon) : def_icon
                - hidden_count+=1 if @filters.include?(cond)
                a href="all_rules#go-#{cond}" class="em12 #{@filters.include?(cond) ? 'hidden' : 'visible'}"
                  i class="fa-fw align-left #{icon['icon']} #{icon['color']} inline cond-div" title="#{@rules_plus['rules'].fetch(cond,{}).fetch('description','...')}" data-rule-div="#{cond}"
                |  
              - if hidden_count>0
                - hidden=@jobs_plus[job.drms_job_id]['filtered']
                span class="gray-text hidden_rules_count" data-id="#{job.drms_job_id}" title="–ß–∏—Å–ª–æ —Å–∫—Ä—ã—Ç—ã—Ö –ø—Ä–∞–≤–∏–ª" +#{hidden}
            - else
              /= image_tag "ok.png", size: "20", border: 2
              i class="fas fa-fw fa-check em12 color-green" title="–í—Å—ë –≤ –ø–æ—Ä—è–¥–∫–µ, –∑–∞–º–µ—á–∞–Ω–∏–π –Ω–µ—Ç!"
          - else
            p 
              | –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö...
        td
          - d="–ü–æ–¥—Ä–æ–±–Ω–µ–µ –ø—Ä–æ —ç—Ç–æ—Ç –∑–∞–ø—É—Å–∫\n–ò–º—è –∑–∞–¥–∞—á–∏: #{job.get_command}"
          p title="#{d}"
            = link_to(job.drms_job_id, job)
        td class="login-data" = job.login
        td class="login-data" = job.partition
        td = job.start_time.strftime('%F %T')
        td = job.end_time.strftime('%F %T')
        td class="task_state_#{job.state} centered"
          /i class="em15 #{@finish_states.fetch(job.state, 'fas fa-meh-blank')}" title="#{job.state}"
          = job.state.downcase
        td
          / class="sorter-metrics1"
          /| #{job.num_nodes}/#{number_with_precision(job.get_duration_hours, :precision => 1)}/#{number_with_precision(job.get_cpuh, :precision => 1)}
          = job.num_nodes
        td
          = number_with_precision(job.get_duration_hours, :precision => 1)
        /td = number_with_precision(job.get_duration_hours, :precision => 1)

        /td = number_with_precision(job.get_cpuh, :precision => 1)

        /td = "üéñ" * Math.log(job.num_nodes * (job.end_time - job.start_time) / 86400 + 2, 2).to_i

        - stars=Math.log(job.num_nodes * (job.end_time - job.start_time) / 86400 + 2, 2)
        - stars=4 if stars>4
        td
          i class="icon-signal-#{stars.to_i} em2 centered" data-stars="#{stars}"
          br
          = number_with_precision(job.get_cpuh, :precision => 1)
          /== '<i class="fas fa-star"></i>' * stars.to_i
          /== '<i class="fas fa-star-half-alt"></i>' * (stars-stars.to_i > 0.5 ? 1 : 0)

        td class="perf-data job_metric_#{job_ranking[:cpu_user]}"
          = number_with_precision(job_performance[:cpu_user], :precision => 1)

        td class="perf-data job_metric_#{job_ranking[:gpu_load]}"
          = number_with_precision(job_performance[:gpu_load], :precision => 1)

        td class="perf-data job_metric_#{job_ranking[:loadavg]}"
          = number_with_precision(job_performance[:loadavg], :precision => 1)

        td class="perf-data job_metric_#{job_ranking[:ipc]}"
          = number_with_precision(job_performance[:ipc] && job_performance[:ipc], :precision => 2)

        td class="perf-data job_metric_#{job_ranking[:ib_rcv_data_mpi]}"
          = number_with_precision(job_performance[:ib_rcv_data_mpi], :precision => 1)

        td class="perf-data job_metric_#{job_ranking[:ib_xmit_data_mpi]}"
          = number_with_precision(job_performance[:ib_xmit_data_mpi], :precision => 1)

table
  tr
    td
      - if @params[:offset].to_i >= @PER_PAGE
        a href="#{url_for @params.except(:offset).merge(offset: @params[:offset].to_i - @PER_PAGE)}" <<< 
    td width="10px"
    td
      - if @jobs.length == 100
        a href="#{url_for @params.except(:offset).merge(offset: @params[:offset].to_i + @PER_PAGE)}" >>>

javascript:
  var jobs=#{{@jobs_plus.to_json}};
  var jobs_feedback=#{{@jobs_feedback.to_json}};
  var current_user=#{@current_user.id};
  var agree_flags=#{{@agree_flags.to_json}};
  var rules_plus=#{{@rules_plus.to_json}};
  var filters=#{{@filters.to_json}};
  var emails=#{{@emails.to_json}};
  var intro_finished=false;
  var feedback_url='#{{url_for ["account_list","feedback"]}}';

  var rule_pic_other = '<i class="fas fa-fw fa-exclamation-triangle" title="......"></i>'
  var intro_js_object;

  var intro_steps=[
        {
          element: '#intro-step1',
          intro: "–ü—Ä–∏–≤–µ—Ç! –ó–¥–µ—Å—å –º—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º (–æ–±—ã—á–Ω–æ) –≤—Å–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è, –∞ —Ç–∞–∫–∂–µ <span style=\"color: green\">–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ</span> –ø—Ä–æ–±–ª–µ–º—ã —Å –∏—Ö –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é. –°–µ–π—á–∞—Å –º—ã –ø–æ–∫–∞–∂–µ–º –ø—Ä–∏–º–µ—Ä –Ω–∞ –Ω–µ–Ω–∞—Å—Ç–æ—è—â–∏—Ö –∑–∞–¥–∞—á–∞—Ö, –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –∫–∞–∫ –º–æ–∂–Ω–æ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Å–∏—Å—Ç–µ–º–æ–π!",
        },
        {
          element: '#intro-step2',
          intro: "–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–∏—Ä–∞–µ–º –¥–∏–∞–ø–∞–∑–æ–Ω –≤—Ä–µ–º–µ–Ω–∏ –∏ –ª–æ–≥–∏–Ω—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –±—É–¥—É—Ç –≤–∑—è—Ç—ã –≤—Å–µ), –∑–∞—Ç–µ–º –∂–º—ë–º \"–ø–æ–∫–∞–∑–∞—Ç—å\" (—Å–µ–π—á–∞—Å –Ω–∞–∂–º–∏—Ç–µ \"Next\" –∏ –¥–æ–∂–¥–∏—Ç–µ—Å—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã).",
          position: 'bottom',
        },
        {
          element: '#intro-step3',
          intro: '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞ –ø–æ–¥–æ–∂–¥–∏—Ç–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã...',
        },
        {
          element: '#job_row_fake',
          intro: "–ó–¥–µ—Å—å –∫—Ä–∞—Ç–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–ø—É—Å–∫–µ –∑–∞–¥–∞—á–∏. –ú–æ–∂–Ω–æ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É –ø–æ —Å—Ç–æ–ª–±—Ü–∞–º, –Ω–∞–∂–∏–º–∞—è –Ω–∞ –∑–∞–≥–æ–ª–æ–≤–æ–∫.",
        },
        {
          element: '#fake_menu',
          intro: '–ù–∞–∂–∞–≤ —Å—é–¥–∞, —É–≤–∏–¥–∏–º –ø–æ–¥—Ä–æ–±–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º —Å –∫–Ω–æ–ø–∫–∞–º–∏.<br><button class="btn-danger"><i class="far fa-bell-slash"></i></button> - —Ç–∞–∫–æ–π –º–æ–∂–Ω–æ —Å–∫—Ä—ã—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —ç—Ç–æ–≥–æ —Ç–∏–ø–∞ –ø—Ä–æ–±–ª–µ–º –≤–æ –≤—Å–µ—Ö –∑–∞–ø—É—Å–∫–∞—Ö. –ü–æ–∑–∂–µ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç –≤–µ—Ä–Ω—É—Ç—å –µ–≥–æ –ø–æ–∫–∞–∑ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–æ –≤—Å–µ–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏.<br><button class="btn-warning"><i class="far fa-angry"></i></button> - –Ω–∞ —ç—Ç—É –∂–º–∏—Ç–µ, –µ—Å–ª–∏ –í–∞–º –∫–∞–∂–µ—Ç—Å—è, —á—Ç–æ —ç—Ç–∞ –ø—Ä–æ–±–ª–µ–º–∞ —Å–æ–≤—Å–µ–º –Ω–µ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ –∑–∞–ø—É—Å–∫—É.<br><button class="btn-warning"><i class="far fa-ok"></i></button> - –∞ –Ω–∞ —ç—Ç—É, –µ—Å–ª–∏ –µ—Å–ª–∏ –æ—Ü–µ–Ω–∫–∞ –∞–¥–µ–∫–≤–∞—Ç–Ω–∞, –¥–ª—è –Ω–∞—Å —ç—Ç–æ —Ç–æ–∂–µ –≤–∞–∂–Ω–æ.',
        },
        {
          element: '#fake_cond',
          intro: '–≠—Ç–æ - —Å–ø–∏—Å–æ–∫ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö <strong>–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö</strong> –ø—Ä–æ–±–ª–µ–º. –ù–∞–≤–µ–¥–∏—Ç–µ –º—ã—à–∫—É –Ω–∞ –∑–Ω–∞—á–æ–∫ –∏ —É–≤–∏–¥–∏—Ç–µ –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã, –Ω–∞–∂–∞–≤ –Ω–∞ –∑–Ω–∞—á–æ–∫, –ø–æ–ø–∞–¥—ë—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å –±–æ–ª–µ–µ –ø–æ–ª–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏.',
        },
      ]




  // {user:int, cluster: string, job_id: int, task_id: int, class=int, feedback=string},{...}
  $(function(){
    var len=filters.length;
    if (len>0) {
      $('#hidden_count').text('–°–∫—Ä—ã—Ç–æ –ø—Ä–æ–±–ª–µ–º —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é: '+len)
    }
    else {
      $('#hidden_count').text('–ù–µ—Ç —Å–∫—Ä—ã—Ç—ã—Ö –ø—Ä–æ–±–ª–µ–º —Å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é.')
    }
    // mark hidden rules
    filters.forEach(function(rule){
      $("#btn-hide-"+rule).addClass("tinted")
    })
    // mark disabled email notifications
    emails.forEach(function(rule){
      $("#btn-email-"+rule).addClass("tinted")
    })

    if(#{@params[:fake_data].to_i}==1){//RegExp('\[fake_data\]=1', 'gi').test(window.location.search)){
      startIntro(4);
    }
    $("#_fake_data").val(#{@params[:fake_data].to_i == 1 ? 1 : 0});
  });

  function intro_change(new_element){
    var id=$(new_element).attr('id');
    var fake=$('#_fake_data').val()

    if(id=='intro-step2'){
      $('#start_time').datepicker('update', '2011-01-01');
      $('#end_time').datepicker('update', '2011-01-31');
      return true;
    }
    else if(id=='intro-step3'){
      if(parseInt(fake)==0){
        $('#_fake_data').val("1");
        //$('#fake_data').val("1");
        $('#intro-step2 > form').submit();
        return true;
      }
    }
    else {
      $('#_fake_data').val("0");
      // if(id=='fake_hide'){
      //   $('#job_info_1').addClass('target')
      //   intro_js_object.setOptions({steps: intro_steps})
      // } else if(id=='fake_cond'){
      //   $('#job_info_1').removeClass('target')
      // }
    }
  }

  function startIntro(startStep){
    var intro = introJs();
    intro_js_object=intro;
    var step3text;
    var steps=[]

    if(startStep==undefined){
      startStep=1
    }

    intro.onbeforechange(intro_change)
    .setOptions({
      steps: intro_steps
    })
    .onbeforeexit(function () {
      if(intro_finished)
        return true;
      var answer=confirm("–ó–∞–∫–æ–Ω—á–∏—Ç—å –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ? –í—ã –º–æ–∂–µ—Ç–µ —Å–Ω–æ–≤–∞ –µ–≥–æ –ø—Ä–æ–π—Ç–∏ –ø–æ–∑–∂–µ, –Ω–∞–∂–∞–≤ \"–¢—É—Ä\" –≤–Ω–∏–∑—É —Å—Ç—Ä–∞–Ω–∏—Ü—ã.");
      if(answer){
        $('#_fake_data').val(0)
      }
      return answer;
    }).start().goToStepNumber(startStep);
  }