<div class="container mt-4">
  <div class="mb-4">
    <%= link_to admin_job_notifications_path, class: "btn btn-outline-secondary" do %>
      <i class="fa fa-arrow-left"></i> <%= t('.back_to_list') %>
    <% end %>
  </div>

  <div class="card mb-4">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h2><%= @notification.name %></h2>
      <div>
        <%= link_to t('.edit'), edit_admin_job_notification_path(@notification), class: "btn btn-warning" %>
        <%= link_to t('.delete'), admin_job_notification_path(@notification), method: :delete, data: { confirm: t('.confirm_delete') }, class: "btn btn-danger" %>
      </div>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-6">
          <h4><%= t('.basic_info') %></h4>
          <table class="table">
            <tr>
              <th width="30%"><%= t('.columns.id') %></th>
              <td><%= @notification.id %></td>
            </tr>
            <tr>
              <th><%= t('.columns.name') %></th>
              <td><%= @notification.name %></td>
            </tr>
            <tr>
              <th><%= t('.columns.description') %></th>
              <td><%= @notification.description || t('.not_specified') %></td>
            </tr>
            <tr>
              <th><%= t('.columns.created_at') %></th>
              <td><%= @notification.created_at.strftime("%d.%m.%Y %H:%M") %></td>
            </tr>
            <tr>
              <th><%= t('.columns.updated_at') %></th>
              <td><%= @notification.updated_at.strftime("%d.%m.%Y %H:%M") %></td>
            </tr>
          </table>
        </div>

        <div class="col-md-6">
          <h4><%= t('.global_settings') %></h4>
          <% if @notification.global_default %>
            <table class="table">
              <tr>
                <th width="30%"><%= t('.columns.notify_telegram') %></th>
                <td><%= @notification.global_default.notify_tg ? t('.yes') : t('.no') %></td>
              </tr>
              <tr>
                <th><%= t('.columns.notify_email') %></th>
                <td><%= @notification.global_default.notify_mail ? t('.yes') : t('.no') %></td>
              </tr>
              <tr>
                <th><%= t('.columns.stop_job') %></th>
                <td><%= @notification.global_default.kill_job ? t('.yes') : t('.no') %></td>
              </tr>
            </table>
            <div class="mt-3">
              <%= link_to t('.edit_global_settings'), edit_admin_job_notification_job_notification_global_default_path(@notification), class: "btn btn-outline-primary" %>
            </div>
          <% else %>
            <div class="alert alert-warning">
              <%= t('.global_settings_not_set_html', link: link_to(t('.set_up'), edit_admin_job_notification_job_notification_global_default_path(@notification), class: "alert-link")) %>
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <div class="card mb-4">
    <div class="card-header">
      <h3><%= t('.user_settings') %></h3>
    </div>
    <div class="card-body">
      <% if @notification.user_defaults.any? %>
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th><%= t('.columns.user') %></th>
                <th><%= t('.columns.telegram') %></th>
                <th><%= t('.columns.email') %></th>
                <th><%= t('.columns.stop_job') %></th>
                <th><%= t('.columns.actions') %></th>
              </tr>
            </thead>
            <tbody>
              <% @notification.user_defaults.includes(:user).each do |user_default| %>
                <tr>
                  <td><%= link_to user_default.user.email, admin_users_path(user_default.user) %></td>
                  <td><%= user_default.notify_tg.nil? ? t('.default') : (user_default.notify_tg ? t('.yes') : t('.no')) %></td>
                  <td><%= user_default.notify_mail.nil? ? t('.default') : (user_default.notify_mail ? t('.yes') : t('.no')) %></td>
                  <td><%= user_default.kill_job.nil? ? t('.default') : (user_default.kill_job ? t('.yes') : t('.no')) %></td>
                  <td>
                    <%= link_to t('.view'), users_job_notifications_path(user_default.user), class: "btn btn-sm btn-info" %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      <% else %>
        <div class="alert alert-info">
          <%= t('.no_user_settings') %>
        </div>
      <% end %>
    </div>
  </div>
</div>
